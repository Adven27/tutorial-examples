<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/batch"
             xmlns:jee="http://www.springframework.org/schema/jee"
             xmlns:beans="http://www.springframework.org/schema/beans"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="
               http://www.springframework.org/schema/jee
               http://www.springframework.org/schema/jee/spring-jee-3.0.xsd
               http://www.springframework.org/schema/beans
               http://www.springframework.org/schema/beans/spring-beans.xsd
               http://www.springframework.org/schema/batch
               http://www.springframework.org/schema/batch/spring-batch-3.0.xsd">

    <job id="messagesender">
        <step id="bills">
            <tasklet>
                <chunk reader="itemReader" processor="itemProcessor" writer="itemWriter" commit-interval="3"/>
            </tasklet>
        </step>
    </job>

    <jee:jndi-lookup id="dataSource" jndi-name="jdbc/svat/mobilebank"/>

    <beans:bean id="itemReader" class="org.springframework.batch.item.database.JdbcPagingItemReader" scope="step">
        <beans:property name="dataSource" ref="dataSource"/>
        <beans:property name="queryProvider">
            <beans:bean class="org.springframework.batch.item.database.support.OraclePagingQueryProvider">
                <beans:property name="selectClause" value="select *"/>
                <beans:property name="fromClause" value="from CLIENT"/>
                <beans:property name="sortKeys">
                    <beans:map>
                        <beans:entry key="id" value="ASCENDING"/>
                    </beans:map>
                </beans:property>
            </beans:bean>
        </beans:property>
        <beans:property name="rowMapper">
            <beans:bean class="org.springframework.jdbc.core.BeanPropertyRowMapper">
                <beans:property name="mappedClass" value="javaeetutorial.batch.messagesender.items.Client"/>
            </beans:bean>
        </beans:property>
        <beans:property name="pageSize" value="3"/>
    </beans:bean>

    <beans:bean id="itemProcessor" class="org.springframework.batch.item.support.PassThroughItemProcessor"/>

    <beans:bean id="itemWriter" class="javaeetutorial.batch.messagesender.MessageWriter" scope="step">
        <beans:property name="messageId" value="#{jobParameters[messageId]}"/>
        <beans:property name="sql" value="UPDATE Message SET text = :text WHERE id = :id"/>
        <beans:property name="jdbcTemplate">
            <beans:bean class="org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate">
                <beans:constructor-arg ref="dataSource"/>
            </beans:bean>
        </beans:property>
    </beans:bean>

</beans:beans>